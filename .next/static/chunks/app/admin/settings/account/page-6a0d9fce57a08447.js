(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[210],{2861:function(e,s,t){Promise.resolve().then(t.bind(t,2982))},3472:function(e,s,t){"use strict";Object.defineProperty(s,"$",{enumerable:!0,get:function(){return l}});let a=t(5355);function l(e){let{createServerReference:s}=t(7355);return s(e,a.callServer)}},6993:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"RouterContext",{enumerable:!0,get:function(){return a}});let a=t(6921)._(t(4090)).default.createContext(null)},2982:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return y}});var a=t(3827),l=t(4090),r=t(1126);t(5355);var n=t(3472),i=(0,n.$)("d654e495d7aca069728d5cb0fb48df33411302f8"),c=(0,n.$)("75f7c420b5857164fcae65ccb976dd4744fee9ff"),d=t(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,d.Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),u=(0,d.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=t(1213),x=t(8994);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,d.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),p=(0,d.Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),h=(0,d.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var b=t(703);function y(){var e,s,t,n;let{data:d,update:y}=(0,r.useSession)(),[g,v]=(0,l.useState)(!1),[j,N]=(0,l.useState)(!1),[w,k]=(0,l.useState)(null),[C,P]=(0,l.useState)((null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.image)||"");async function Z(e){var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!t)return;N(!0);let a=new FormData;a.append("file",t);try{let e=await fetch("/api/upload/avatar",{method:"POST",body:a});if(!e.ok)throw Error("Upload failed");let s=await e.json();P(s.url)}catch(e){console.error("Error uploading avatar:",e),k({type:"error",text:"头像上传失败"})}finally{N(!1)}}async function S(e){v(!0),k(null),e.set("image",C);try{await c(e),await y({user:{...null==d?void 0:d.user,image:C,name:e.get("name")}}),k({type:"success",text:"个人资料已更新"})}catch(e){k({type:"error",text:e.message||"更新失败"})}finally{v(!1)}}async function _(e){v(!0),k(null);try{await i(e),k({type:"success",text:"密码修改成功"}),document.getElementById("password-form").reset()}catch(e){k({type:"error",text:e.message||"修改失败"})}finally{v(!1)}}return(0,l.useEffect)(()=>{var e;(null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.image)&&P(d.user.image)},[null==d?void 0:null===(s=d.user)||void 0===s?void 0:s.image]),(0,a.jsxs)("div",{className:"space-y-6 max-w-2xl",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"账号设置"}),(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:"管理您的个人资料和安全设置"})]}),w&&(0,a.jsxs)("div",{className:"p-4 rounded-lg flex items-center gap-3 ".concat("success"===w.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:["success"===w.type?(0,a.jsx)(o,{className:"w-5 h-5"}):(0,a.jsx)(u,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:w.text})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-6 shadow-sm",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 text-slate-500"}),"基本信息"]}),(0,a.jsxs)("form",{action:S,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 overflow-hidden border border-slate-200",children:[C?(0,a.jsx)(b.default,{src:C,alt:"Avatar",fill:!0,className:"object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:(0,a.jsx)(m.Z,{className:"w-10 h-10"})}),j&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"w-6 h-6 text-white animate-spin"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"头像"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("label",{className:"cursor-pointer flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium text-slate-700",children:[(0,a.jsx)(f,{className:"w-4 h-4"}),"更换头像",(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:Z,disabled:j})]}),C&&(0,a.jsx)("button",{type:"button",onClick:()=>P(""),className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"删除"})]}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"支持 JPG, PNG, GIF 格式，建议尺寸 200x200px"})]}),(0,a.jsx)("input",{type:"hidden",name:"image",value:C})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"姓名"}),(0,a.jsx)("input",{name:"name",defaultValue:(null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.name)||"",required:!0,className:"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"邮箱"}),(0,a.jsx)("input",{type:"email",name:"email",defaultValue:(null==d?void 0:null===(n=d.user)||void 0===n?void 0:n.email)||"",required:!0,className:"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsxs)("button",{type:"submit",disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition-colors disabled:opacity-50",children:[g?(0,a.jsx)(x.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(p,{className:"w-4 h-4"}),"保存资料"]})})]})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl p-6 shadow-sm",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(h,{className:"w-5 h-5 text-slate-500"}),"修改密码"]}),(0,a.jsxs)("form",{id:"password-form",action:_,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"当前密码"}),(0,a.jsx)("input",{type:"password",name:"currentPassword",required:!0,className:"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"新密码"}),(0,a.jsx)("input",{type:"password",name:"newPassword",required:!0,minLength:6,className:"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"确认新密码"}),(0,a.jsx)("input",{type:"password",name:"confirmPassword",required:!0,minLength:6,className:"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsxs)("button",{type:"submit",disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-white text-slate-700 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50",children:[g?(0,a.jsx)(x.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(p,{className:"w-4 h-4"}),"更新密码"]})})]})]})]})}}},function(e){e.O(0,[350,470,971,69,744],function(){return e(e.s=2861)}),_N_E=e.O()}]);